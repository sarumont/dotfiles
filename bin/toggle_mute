#!/bin/sh

if test $# -ne 2; then
	echo "Usage: toggle_mute <device> <chan>"
	exit 1
fi

if ! test -e $1; then
	echo "$1 is not a valid mixer device"
	exit 1
fi

mixer=`which mixer`
cur=`$mixer -f $1 $2 | awk '{print $7}' | awk -F: '{print $1}'`

mixer_dev=${1#/*/}
fn=/tmp/${mixer_dev}.${2}
if test -f $fn; then
	old=`cat $fn`
	rm $fn
else
	echo $cur > $fn
fi

if test $cur -eq 0; then
	echo "unmuting $mixer_dev"
	$mixer -f $1 $2 $old 2>&1 > /dev/null
else
	echo "muting $mixer_dev"
	$mixer -f $1 $2 0 2>&1 > /dev/null
fi
