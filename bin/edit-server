#!/usr/bin/env ruby

require 'webrick'
require 'tempfile'
 
# Start gvim in foreground mode
$EDITOR = "gvim -f "
s = WEBrick::HTTPServer.new(:Port => 42420)
%w(INT TERM).each { |signal| trap(signal) { s.shutdown } }
 
s.mount_proc("/") do |req,res|
    t = Tempfile.open('textaid') { |f| f.write(req.body); f }
    system($EDITOR + t.path)
    res.body = File.read(t.path)
    t.unlink
end
 
s.start
